# vim: set ft=ansible:
---
- hosts: localhost
  connection: local
  sudo: no
  gather_facts: no
  tasks:
  - fail:
      msg: required values not set
    when: cluster_id is not defined or ec2_region is not defined or ec2_image is not defined or ec2_keypair is not defined or ec2_master_instance_type is not defined or ec2_infra_instance_type is not defined or ec2_node_instance_type is not defined or r53_zone is not defined or r53_host_zone is not defined or r53_wildcard_zone is not defined or num_app_nodes is not defined or hexboard_size is not defined or rhsm_user is not defined or rhsm_pass is not defined or deployment_type is not defined

# create VPC configuration
- include: util_playbooks/create_vpc.yml

# Create the AWS security groups if not already present
- include: util_playbooks/create_security_groups.yml
  vars:
    vpc_id: "{{ vpc.vpc_id }}"

# Create the elbs
- include: util_playbooks/create_elbs.yml
  vars:
    vpc_subnet_ids: "{{ vpc.subnets | oo_collect('id') }}"

# create instances
- include: util_playbooks/create_instances.yml
  vars:
    master_sg_id: "{{ master_sg.group_id }}"
    node_sg_id: "{{ node_sg.group_id }}"
    infra_sg_id: "{{ infra_sg.group_id }}"
    vpc_subnet_ids: "{{ vpc.subnets | oo_collect('id') }}"
